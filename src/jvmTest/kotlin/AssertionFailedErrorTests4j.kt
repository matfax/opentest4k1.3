package com.willowtreeapps.opentest4k

import java.io.ByteArrayInputStream
import java.io.ByteArrayOutputStream
import java.io.ObjectInputStream
import java.io.ObjectOutputStream

actual typealias Serialized = ByteArray

actual inline fun <reified T : Any> deserialize(bytes: Serialized): T {
    val `in` = ObjectInputStream(ByteArrayInputStream(bytes))
    @Suppress("UNCHECKED_CAST")
    return `in`.readObject() as T
}

actual fun serialize(`object`: Any): Serialized {
    val byteArrayOutputStream = ByteArrayOutputStream()
    val out = ObjectOutputStream(byteArrayOutputStream)
    out.writeObject(`object`)
    out.flush()
    return byteArrayOutputStream.toByteArray()
}
