buildscript {
    ext.kotlin_version = '1.3.0-rc-57'

    repositories {
        jcenter()
        mavenCentral()
        maven {
            url "https://plugins.gradle.org/m2/"
            maven { url "https://dl.bintray.com/kotlin/kotlin-eap" }
        }
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.4'
    }
}

group 'com.willowtreeapps.opentest4k'
version '1.1.0'

apply plugin: 'kotlin-multiplatform'

repositories {
    jcenter()
    mavenCentral()
    maven { url "https://dl.bintray.com/kotlin/kotlin-eap" }
}

kotlin {
    targets {
        fromPreset(presets.jvm, 'jvm')
        fromPreset(presets.js, 'js')
        fromPreset(presets.linuxX64, 'linux')
        fromPreset(presets.macosX64, 'mac')
        fromPreset(presets.iosArm64, 'iosArm')
        fromPreset(presets.iosX64, 'iosX64')
    }

    sourceSets {
        commonMain {
            languageSettings {
                progressiveMode = true
            }
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib-common'
            }
        }
        testMain {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test-common'
                implementation 'org.jetbrains.kotlin:kotlin-test-annotations-common'
            }
        }
        jvmMain {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib'
                implementation "org.opentest4j:opentest4j:1.1.0"
            }
        }
        jvmTest {
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test'
                implementation 'org.jetbrains.kotlin:kotlin-test-junit'
            }
        }
        jsNativeMain {
            dependsOn commonMain
        }
        jsNativeTest {
            dependsOn commonTest
        }
        jsMain {
            dependsOn jsNativeMain
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-stdlib-js'
            }
        }
        jsTest {
            dependsOn jsNativeTest
            dependencies {
                implementation 'org.jetbrains.kotlin:kotlin-test-js'
            }
        }
        nativeMain {
            dependsOn jsNativeMain
        }
        nativeTest {
            dependsOn jsNativeTest
        }

        configure([linuxMain, macMain, iosArmMain, iosX64Main]) {
            dependsOn nativeMain
        }

        configure([linuxTest, macTest, iosArmTest, iosX64Test]) {
            dependsOn nativeTest
        }
    }
}

tasks.register("test").configure {
    dependsOn(["jvmTest", "jsTest", "linuxTest", "macTest"])
}
